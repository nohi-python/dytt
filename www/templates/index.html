{% extends '__base__.html' %}

{% block title %}编辑日志{% endblock %}

{% block beforehead %}

<script>
  __basePath = '{{ __basePath__ }}'
  console.info('index.html __basePath:' + __basePath)

    function initVM(data) {
        var vm = new Vue({
            el: '#vm',
            data: {
                movies: data.movies,
                page: data.page
            },
            methods: {
                refresh_movies: function () {
                    console.info('===refresh_movies===')
                    if (confirm('确认更新电影？')) {
                        postJSON(__basePath + '/api/movie/refresh', function (err, r) {
                            if (err) {
                                return alert(err.message || err.error || err);
                            }
                            refresh();
                        });
                    }
                }
            }
        });
        $('#vm').show();
    }

    $(function () {
        getJSON(__basePath + '/api/movies', {
            page: {{ page_index }}
        }, function(err, results) {
            if (err) {
                return fatal(err);
            }
            $('#loading').hide();
            initVM(results);
        });
    });
</script>
{% endblock %}

{% block content %}
<div id="vm" class="uk-width-1-1">
    <button @click="refresh_movies" class="uk-button uk-button-primary" ><i class="uk-icon-plus"></i>更新</button>
    <table class="uk-table uk-table-hover">
        <thead>
        <tr>
            <th class="uk-width-1-10">电影名称</th>
            <th class="uk-width-1-10">产地</th>
            <th class="uk-width-1-10">导演</th>
            <th class="uk-width-1-10">主演</th>
            <th class="uk-width-1-10">上映时间</th>
            <th class="uk-width-1-10">豆瓣评分</th>
            <th class="uk-width-1-10">简介</th>
            <th class="uk-width-1-10">获奖情况</th>
            <th class="uk-width-1-10">更新时间</th>
        </tr>
        </thead>
        <tbody>
        <tr v-for="movie in movies">
            <td>
                <a target="_blank" :href="movie.uri" v-text="movie.name"></a>
            </td>
            <td>
                <span v-text="movie.chandi"></span>
            </td>
             <td>
                <span v-text="movie.daoyan"></span>
            </td>
             <td>
                <span class="textover" :title="movie.zhuyan" v-text="movie.zhuyan"></span>
            </td>
             <td>
                <span class="textover" :title="movie.shangyinshijian" v-text="movie.shangyinriqi"></span>
            </td>
             <td>
                <span class="textover"  :title="movie.doubanpinfen"  v-text="movie.doubanpinfen"></span>
            </td>
             <td>
                <span class="textover"  :title="movie.jianjie"  v-text="movie.jianjie"></span>
            </td>
             <td>
                <span class="textover"  :title="movie.huojian"  v-text="movie.huojian"></span>
            </td>
            <td>
                <span v-text="movie.updated_at.toDateTime()"></span>
            </td>
        </tr>
        </tbody>
    </table>
    <pagination :page="page"></pagination>
</div>
{% endblock %}
